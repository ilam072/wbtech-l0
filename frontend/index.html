<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Поиск заказа</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background: #f7f7f7;
            padding: 2rem;
            display: flex;
            justify-content: center;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
        }
        input {
            padding: 0.6rem 1rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 93%;
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        button {
            background-color: #4f46e5;
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
        }
        .error {
            margin-top: 2rem;
            background: #ffecec;
            color: #c00;
            padding: 1rem;
            border-radius: 12px;
            font-size: 0.95rem;
        }
        .error small {
            font-size: 0.8rem;
            display: block;
            color: #900;
        }
        .order-card {
            margin-top: 2rem;
            background: #f0f0ff;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 0.95rem;
            color: #222;
        }
        .section {
            margin-bottom: 1.5rem;
        }
        .section h3 {
            margin-bottom: 0.5rem;
            border-bottom: 1px solid #ccc;
            padding-bottom: 0.25rem;
            color: #4f46e5;
        }
        .field {
            display: flex;
            justify-content: space-between;
            padding: 0.25rem 0;
            border-bottom: 1px solid #ddd;
        }
        .field:last-child {
            border-bottom: none;
        }
        .field-label {
            font-weight: 600;
            color: #555;
            max-width: 40%;
            word-break: break-word;
        }
        .field-value {
            max-width: 55%;
            text-align: right;
            word-break: break-word;
            white-space: pre-wrap;
        }
        .items-list {
            border: 1px solid #bbb;
            border-radius: 10px;
            padding: 0.5rem 1rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .item {
            border-bottom: 1px solid #ccc;
            padding: 0.5rem 0;
        }
        .item:last-child {
            border-bottom: none;
        }
        .item-title {
            font-weight: 700;
            margin-bottom: 0.3rem;
            color: #3a3a9f;
        }
    </style>
</head>
<body>
<div id="app" class="container">
    <h2>Введите идентификатор заказа</h2>
    <input v-model="orderId" placeholder="UUID заказа..." />
    <button @click="fetchOrder">Получить</button>

    <div v-if="error" class="error">
        Ошибка ⚠️
        <small>{{ error }}</small>
    </div>

    <div v-if="order" class="order-card">
        <div class="section">
            <h3>Order</h3>
            <div class="field"><div class="field-label">Order UID:</div><div class="field-value">{{ order.order_uid }}</div></div>
            <div class="field"><div class="field-label">Track Number:</div><div class="field-value">{{ order.track_number }}</div></div>
            <div class="field"><div class="field-label">Entry:</div><div class="field-value">{{ order.entry }}</div></div>
            <div class="field"><div class="field-label">Locale:</div><div class="field-value">{{ order.locale }}</div></div>
            <div class="field"><div class="field-label">Customer ID:</div><div class="field-value">{{ order.customer_id }}</div></div>
            <div class="field"><div class="field-label">Delivery Service:</div><div class="field-value">{{ order.delivery_service }}</div></div>
            <div class="field"><div class="field-label">Date Created:</div><div class="field-value">{{ order.date_created }}</div></div>
        </div>

        <div class="section" v-if="order.delivery">
            <h3>Delivery</h3>
            <div class="field"><div class="field-label">Name:</div><div class="field-value">{{ order.delivery.name }}</div></div>
            <div class="field"><div class="field-label">Phone:</div><div class="field-value">{{ order.delivery.phone }}</div></div>
            <div class="field"><div class="field-label">Zip:</div><div class="field-value">{{ order.delivery.email }}</div></div>
            <div class="field"><div class="field-label">City:</div><div class="field-value">{{ order.delivery.city }}</div></div>
            <div class="field"><div class="field-label">Address:</div><div class="field-value">{{ order.delivery.region }}</div></div>
            <div class="field"><div class="field-label">Region:</div><div class="field-value">{{ order.delivery.address }}</div></div>
            <div class="field"><div class="field-label">Email:</div><div class="field-value">{{ order.delivery.zip }}</div></div>
        </div>

        <div class="section" v-if="order.payment">
            <h3>Payment</h3>
            <div class="field"><div class="field-label">Transaction:</div><div class="field-value">{{ order.payment.transaction }}</div></div>
            <div class="field"><div class="field-label">RequestID:</div><div class="field-value">{{ order.payment.request_id }}</div></div>
            <div class="field"><div class="field-label">Currency:</div><div class="field-value">{{ order.payment.currency }}</div></div>
            <div class="field"><div class="field-label">Provider:</div><div class="field-value">{{ order.payment.provider }}</div></div>
            <div class="field"><div class="field-label">Amount:</div><div class="field-value">{{ order.payment.amount }}</div></div>
            <div class="field"><div class="field-label">Payment date:</div><div class="field-value">{{ order.payment.payment_dt }}</div></div>
            <div class="field"><div class="field-label">Bank:</div><div class="field-value">{{ order.payment.bank }}</div></div>
            <div class="field"><div class="field-label">Delivery cost:</div><div class="field-value">{{ order.payment.delivery_cost }}</div></div>
            <div class="field"><div class="field-label">Goods total:</div><div class="field-value">{{ order.payment.goods_total }}</div></div>
            <div class="field"><div class="field-label">Custom fee:</div><div class="field-value">{{ order.payment.custom_fee }}</div></div>
        </div>

        <div class="section" v-if="order.items && order.items.length">
            <h3>Items</h3>
            <div class="items-list">
                <div class="item" v-for="(item, index) in order.items" :key="item.chrt_id + '-' + index">
                    <div class="item-title">{{ item.name }}</div>
                    <div class="field"><div class="field-label">ID (chrt_id):</div><div class="field-value">{{ item.chrt_id }}</div></div>
                    <div class="field"><div class="field-label">Track number:</div><div class="field-value">{{ item.track_number }}</div></div>
                    <div class="field"><div class="field-label">Price:</div><div class="field-value">{{ item.price }}</div></div>
                    <div class="field"><div class="field-label">Sale:</div><div class="field-value">{{ item.sale }}</div></div>
                    <div class="field"><div class="field-label">Size:</div><div class="field-value">{{ item.size }}</div></div>
                    <div class="field"><div class="field-label">Total price:</div><div class="field-value">{{ item.total_price }}</div></div>
                    <div class="field"><div class="field-label">Nm ID:</div><div class="field-value">{{ item.nm_id }}</div></div>
                    <div class="field"><div class="field-label">Brand:</div><div class="field-value">{{ item.brand }}</div></div>
                    <div class="field"><div class="field-label">Status:</div><div class="field-value">{{ item.status }}</div></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref } = Vue;

    createApp({
        setup() {
            const orderId = ref('');
            const order = ref(null);
            const error = ref(null);

            const fetchOrder = async () => {
                error.value = null;
                order.value = null;

                try {
                    const res = await fetch(`http://localhost:8082/api/order/${orderId.value}`, {
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    const data = await res.json();

                    if (!res.ok) {
                        const status = res.status;

                        if (status === 400) {
                            throw new Error(`Некорректный формат UUID`);
                        } else if (status === 404) {
                            throw new Error(`Заказ не найден`);
                        } else if (status === 500) {
                            throw new Error(`Внутренняя ошибка сервера`);
                        } else {
                            throw new Error(data.message || `Ошибка: ${status}`);
                        }
                    }

                    order.value = data;
                } catch (err) {
                    error.value = err.message;
                }
            };

            return {
                orderId,
                order,
                error,
                fetchOrder,
            };
        }
    }).mount('#app');
</script>
</body>
</html>
